!function(e){"use strict";"undefined"==typeof ffcAudience&&(window.ffcAudience={ajaxUrl:"/wp-admin/admin-ajax.php",restUrl:"/wp-json/ffc/v1/audience/",nonce:""}),ffcAudience.strings||(ffcAudience.strings={}),ffcAudience.locale&&(ffcAudience.locale=ffcAudience.locale.replace("_","-"));var n={months:["January","February","March","April","May","June","July","August","September","October","November","December"],loading:"Loading...",error:"An error occurred. Please try again.",noBookings:"No bookings for this day.",noActiveBookings:"No active bookings for this day.",bookingCreated:"Booking created successfully!",bookingCancelled:"Booking cancelled successfully.",confirmCancel:"Are you sure you want to cancel this booking?",cancelReason:"Please provide a reason for cancellation:",invalidTime:"End time must be after start time.",selectAudience:"Please select at least one audience.",selectUser:"Please select at least one user.",descriptionRequired:"Description is required (15-300 characters).",conflictWarning:"Warning: Conflicts detected with existing bookings.",holiday:"Holiday",closed:"Closed",cancelled:"Cancelled",cancel:"Cancel",available:"Available",booked:"Booked",timeout:"Request timed out. Please try again.",checkConflicts:"Check Conflicts",booking:"booking",bookings:"bookings",createBooking:"Create Booking",newBooking:"New Booking",multipleAudiences:"Multiple audiences"};for(var t in n)ffcAudience.strings[t]||(ffcAudience.strings[t]=n[t]);var i={currentDate:new Date,selectedSchedule:0,selectedEnvironment:0,config:{},bookings:{},holidays:{},selectedUsers:{}};function o(){var n=e("#ffc-environment-select");n.find("option:not(:first)").remove();var t=i.config.schedules||[],o=[],c=(ffcAudience.strings||{}).allEnvironments||"All Environments";if(i.selectedSchedule>0){for(var a=0;a<t.length;a++)if(parseInt(t[a].id)===parseInt(i.selectedSchedule)){o=t[a].environments||[],t[a].environmentLabelPlural&&(c=(ffcAudience.strings||{}).all?ffcAudience.strings.all+" "+t[a].environmentLabelPlural:t[a].environmentLabelPlural);break}}else for(var s=0;s<t.length;s++)for(var r=t[s].environments||[],f=0;f<r.length;f++)o.push(r[f]);n.find("option:first").text(c),o.forEach(function(e){n.append('<option value="'+e.id+'" data-color="'+(e.color||"#3788d8")+'">'+e.name+"</option>")}),i.selectedEnvironment>0&&n.val(i.selectedEnvironment)}function c(){var n=i.currentDate.getFullYear(),t=i.currentDate.getMonth();e(".ffc-current-month").text(ffcAudience.strings.months[t]+" "+n);var o=e("#ffc-event-list-panel .ffc-event-list-header h3");o.length&&o.text(((ffcAudience.strings||{}).events||"Events")+" - "+ffcAudience.strings.months[t]+" "+n);var c=new Date(n,t,1),f=new Date(n,t+1,0),l=c.getDay(),u=f.getDate(),g=new Date(n,t,0).getDate(),h="",y=1,A=1,_=new Date;_.setHours(0,0,0,0),function(n,t,o){var c=n+"-"+b(t)+"-01",a=new Date(n,t,0).getDate(),s=n+"-"+b(t)+"-"+b(a),r={start_date:c,end_date:s};i.selectedSchedule>0&&(r.schedule_id=i.selectedSchedule);i.selectedEnvironment>0&&(r.environment_id=i.selectedEnvironment);e.ajax({url:ffcAudience.restUrl+"bookings",method:"GET",data:r,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcAudience.nonce)},success:function(e){i.bookings={},i.holidays={},i.closedWeekdays=[],e.bookings&&e.bookings.forEach(function(e){i.bookings[e.booking_date]||(i.bookings[e.booking_date]=[]),i.bookings[e.booking_date].push(e)}),e.holidays&&e.holidays.forEach(function(e){i.holidays[e.holiday_date]=e.description||!0}),e.closed_weekdays&&(i.closedWeekdays=e.closed_weekdays),o&&o()},error:function(){o&&o()}})}(n,t+1,function(){for(var o=0;o<6;o++)for(var c=0;c<7;c++){var f,b,w,D=["ffc-day"];0===o&&c<l?(b=g-l+c+1,f=new Date(n,t-1,b),D.push("ffc-other-month")):y>u?(b=A++,f=new Date(n,t+1,b),D.push("ffc-other-month")):(b=y++,f=new Date(n,t,b)),w=p(f),f<_&&D.push("ffc-past"),f.getTime()===_.getTime()&&D.push("ffc-today");var x=i.holidays[w];x&&(D.push("ffc-holiday"),D.push("ffc-disabled"));var E=f.getDay(),S=i.closedWeekdays&&-1!==i.closedWeekdays.indexOf(E);S&&!x&&(D.push("ffc-closed"),D.push("ffc-disabled"));var I=-1!==D.indexOf("ffc-other-month"),C=-1!==D.indexOf("ffc-past"),j=s(f);I||C||S||x||!j||D.push("ffc-available");var q=a(w);h+='<div class="'+D.join(" ")+'" data-date="'+w+'">',h+='<span class="ffc-day-number">'+b+"</span>",h+='<div class="ffc-day-content">',x?h+='<span class="ffc-day-badge ffc-badge-holiday">'+ffcAudience.strings.holiday+"</span>":S?h+='<span class="ffc-day-badge ffc-badge-closed">'+ffcAudience.strings.closed+"</span>":q>0&&(h+='<span class="ffc-day-badge ffc-badge-bookings">'+q+" "+(1===q?ffcAudience.strings.booking:ffcAudience.strings.bookings)+"</span>"),h+="</div></div>"}e("#ffc-calendar-days").html(h),function(){var n=e("#ffc-event-list-content");if(!n.length)return;var t=[];for(var o in i.bookings)for(var c=i.bookings[o],a=0;a<c.length;a++)"active"===c[a].status&&t.push({type:"booking",date:c[a].booking_date,data:c[a]});for(var s in i.holidays){var f=i.holidays[s];t.push({type:"holiday",date:s,data:{description:"string"==typeof f?f:""}})}if(0===t.length)return void n.html('<p class="ffc-no-events">'+((ffcAudience.strings||{}).noEvents||"No events this month.")+"</p>");t.sort(function(e,n){return e.date<n.date?-1:e.date>n.date?1:"holiday"===e.type&&"holiday"!==n.type?-1:"holiday"!==e.type&&"holiday"===n.type?1:"booking"===e.type&&"booking"===n.type?e.data.start_time.localeCompare(n.data.start_time):0});var l="",u="";t.forEach(function(e){if(e.date!==u){u=e.date;var n=v(e.date).toLocaleDateString(ffcAudience.locale,{weekday:"short",day:"numeric",month:"short"});l+='<div class="ffc-event-list-date">'+n+"</div>"}if("holiday"===e.type){var t=ffcAudience.strings.holiday||"Holiday",i=e.data.description||"";l+='<div class="ffc-event-list-item" data-date="'+e.date+'" style="border-left: 3px solid var(--ffc-warning);">',l+='<span class="ffc-event-list-time ffc-all-day">'+k(t)+"</span>",i&&(l+='<span class="ffc-event-list-desc">'+k(i)+"</span>"),l+="</div>"}else{var o=e.data,c=d(o.environment_id);l+='<div class="ffc-event-list-item" data-date="'+o.booking_date+'" style="border-left: 3px solid '+c+';">',parseInt(o.is_all_day)?l+='<span class="ffc-event-list-time ffc-all-day">'+((ffcAudience.strings||{}).allDay||"All Day")+"</span>":l+='<span class="ffc-event-list-time">'+m(o.start_time)+" - "+m(o.end_time)+"</span>",l+='<span class="ffc-event-list-env">'+k(o.environment_name)+"</span>";var a=o.description||"";if(a.length>60&&(a=a.substring(0,57)+"..."),l+='<span class="ffc-event-list-desc">'+k(a)+"</span>",o.audiences&&o.audiences.length>0){if(l+='<span class="ffc-event-list-audiences">',o.audiences.length>2){var s=ffcAudience.multipleAudiencesColor||"var(--ffc-gray-600)";l+='<span class="ffc-audience-tag-sm" style="background-color: '+s+'">'+k(ffcAudience.strings.multipleAudiences)+" ("+o.audiences.length+")</span>"}else o.audiences.forEach(function(e){l+='<span class="ffc-audience-tag-sm" style="background-color: '+e.color+'">'+k(e.name)+"</span>"});l+="</span>"}l+="</div>"}}),n.html(l),n.find(".ffc-event-list-item").on("click",function(){var n=e(this).data("date");n&&r(n)})}()})}function a(e){return(i.bookings[e]||[]).filter(function(e){return"active"===e.status}).length}function s(e){var n=i.config.schedules||[],t=null;if(i.selectedSchedule>0){for(var o=0;o<n.length;o++)if(n[o].id===i.selectedSchedule){t=n[o].futureDaysLimit;break}}else for(var c=0;c<n.length;c++){var a=n[c].futureDaysLimit;null!==a&&a>0&&(null===t||a<t)&&(t=a)}if(null===t||t<=0)return!0;var s=new Date;return s.setDate(s.getDate()+t),s.setHours(23,59,59,999),e<=s}function r(n){var t=e("#ffc-day-modal"),i=v(n).toLocaleDateString(ffcAudience.locale,{weekday:"long",year:"numeric",month:"long",day:"numeric"});t.find(".ffc-day-modal-title").text(i),t.data("date",n),t.show(),f(n)}function f(n){var t=e("#ffc-day-bookings"),o=i.bookings[n]||[],a=e("#ffc-show-cancelled").is(":checked"),s=o.filter(function(e){return!!a||"active"===e.status});if(0===s.length){var r=ffcAudience.strings.noBookings;return!a&&o.length>0&&(r=ffcAudience.strings.noActiveBookings||"No active bookings for this day."),void t.html('<p class="ffc-no-bookings">'+r+"</p>")}var l="";s.sort(function(e,n){return e.start_time.localeCompare(n.start_time)}),s.forEach(function(e){var n=["ffc-booking-item"];"cancelled"===e.status&&n.push("ffc-booking-cancelled");var t=d(e.environment_id);l+='<div class="'+n.join(" ")+'" style="border-left: 4px solid '+t+';">',parseInt(e.is_all_day)?l+='<div class="ffc-booking-time ffc-all-day">'+((ffcAudience.strings||{}).allDay||"All Day")+"</div>":l+='<div class="ffc-booking-time">'+m(e.start_time)+" - "+m(e.end_time)+"</div>",l+='<div class="ffc-booking-description">'+k(e.description)+"</div>",l+='<div class="ffc-booking-meta">',l+="<span><strong>"+k(function(e){for(var n=parseInt(e.environment_id),t=i.config.schedules||[],o=0;o<t.length;o++)for(var c=t[o].environments||[],a=0;a<c.length;a++)if(parseInt(c[a].id)===n)return t[o].environmentLabel||(ffcAudience.strings||{}).environmentLabel||"Environment";return(ffcAudience.strings||{}).environmentLabel||"Environment"}(e)+":")+"</strong> "+k(e.environment_name)+"</span>","cancelled"===e.status&&(l+=' <span class="ffc-status-cancelled">('+(ffcAudience.strings.cancelled||"Cancelled")+")</span>"),l+="</div>",e.audiences&&e.audiences.length>0&&(l+='<div class="ffc-booking-audiences">',e.audiences.forEach(function(e){l+='<span class="ffc-audience-tag" style="background-color: '+e.color+'">'+k(e.name)+"</span>"}),l+="</div>"),"active"===e.status&&i.config.canBook&&(l+='<div class="ffc-booking-actions">',l+='<button type="button" class="ffc-btn ffc-btn-danger ffc-cancel-booking" data-id="'+e.id+'">'+ffcAudience.strings.cancel+"</button>",l+="</div>"),l+="</div>"}),t.html(l),t.find(".ffc-cancel-booking").on("click",function(){!function(n,t){var i=prompt(ffcAudience.strings.cancelReason);if(!i||""===i.trim())return;e.ajax({url:ffcAudience.restUrl+"bookings/"+n,method:"DELETE",contentType:"application/json",data:JSON.stringify({reason:i}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcAudience.nonce)},success:function(e){e.success?(alert(ffcAudience.strings.bookingCancelled),c(),f(t)):alert(e.message||ffcAudience.strings.error)},error:function(){alert(ffcAudience.strings.error)}})}(e(this).data("id"),n)})}function d(e){e=parseInt(e);for(var n=i.config.schedules||[],t=0;t<n.length;t++)for(var o=n[t].environments||[],c=0;c<o.length;c++)if(parseInt(o[c].id)===e)return o[c].color||"#3788d8";return"#3788d8"}function l(){var n="",t=[];for(var o in i.selectedUsers)n+='<span class="ffc-selected-user">'+k(i.selectedUsers[o])+'<span class="remove" data-id="'+o+'">&times;</span></span>',t.push(o);e("#booking-selected-users").html(n),e("#booking-user-ids").val(t.join(","))}function u(){var n=e("#booking-all-day").is(":checked"),t=e("#booking-start-time").val(),i=e("#booking-end-time").val(),o=e("#booking-description").val().trim(),c=e("#booking-type").val();if(!n){if(!t||!i)return alert("Please fill in the time fields."),!1;if(t>=i)return alert(ffcAudience.strings.invalidTime),!1}if(o.length<15||o.length>300)return alert(ffcAudience.strings.descriptionRequired),!1;if("audience"===c){var a=e("#booking-audiences").val();if(!a||0===a.length)return alert(ffcAudience.strings.selectAudience),!1}else{var s=e("#booking-user-ids").val();if(!s||""===s.trim())return alert(ffcAudience.strings.selectUser),!1}return!0}function g(){var n=e("#booking-type").val(),t=e("#booking-all-day").is(":checked"),i={environment_id:parseInt(e("#booking-environment-id").val()),booking_date:e("#booking-date").val(),start_time:t?"00:00":e("#booking-start-time").val(),end_time:t?"23:59":e("#booking-end-time").val(),is_all_day:t?1:0,booking_type:n,description:e("#booking-description").val().trim(),audience_ids:[],user_ids:[]};return"audience"===n?i.audience_ids=(e("#booking-audiences").val()||[]).map(function(e){return parseInt(e)}):i.user_ids=(e("#booking-user-ids").val()||"").split(",").filter(function(e){return""!==e.trim()}).map(function(e){return parseInt(e)}),i}function h(){e("#ffc-booking-modal, #ffc-day-modal").hide()}function p(e){return e.getFullYear()+"-"+b(e.getMonth()+1)+"-"+b(e.getDate())}function v(e){var n=e.split("-");return new Date(parseInt(n[0],10),parseInt(n[1],10)-1,parseInt(n[2],10))}function m(e){return e?e.substring(0,5):""}function b(e){return(e<10?"0":"")+e}function k(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):""}e(document).ready(function(){var n,t,a,s=e("#ffc-audience-calendar");s.length&&(i.config=JSON.parse(s.attr("data-config")||"{}"),i.selectedSchedule=i.config.scheduleId||0,i.selectedEnvironment=i.config.environmentId||0,o(),(n=e("#booking-audiences")).empty(),(i.config.audiences||[]).forEach(function(e){n.append('<option value="'+e.id+'">'+e.name+"</option>"),e.children&&e.children.length>0&&e.children.forEach(function(e){n.append('<option value="'+e.id+'">   └ '+e.name+"</option>")})}),c(),e(".ffc-prev-month").on("click",function(){i.currentDate.setMonth(i.currentDate.getMonth()-1),c()}),e(".ffc-next-month").on("click",function(){i.currentDate.setMonth(i.currentDate.getMonth()+1),c()}),e(".ffc-today-btn").on("click",function(){i.currentDate=new Date,c()}),e("#ffc-schedule-select").on("change",function(){i.selectedSchedule=parseInt(e(this).val())||0,o(),c()}),e("#ffc-environment-select").on("change",function(){i.selectedEnvironment=parseInt(e(this).val())||0,c()}),e("#ffc-audience-calendar").on("click",".ffc-day:not(.ffc-past):not(.ffc-disabled):not(.ffc-other-month)",function(){var n=e(this).data("date");n&&r(n)}),e("#ffc-booking-modal .ffc-modal-close, #ffc-booking-modal .ffc-modal-cancel, #ffc-day-modal .ffc-modal-close, #ffc-day-modal .ffc-modal-cancel").on("click",function(){h()}),e("#ffc-booking-modal > .ffc-modal-backdrop, #ffc-day-modal > .ffc-modal-backdrop").on("click",function(){h()}),e("#ffc-show-cancelled").on("change",function(){var n=e("#ffc-day-modal").data("date");n&&f(n)}),e("#booking-all-day").on("change",function(){e(this).is(":checked")?(e("#booking-time-row").hide(),e("#booking-start-time").removeAttr("required").val("00:00"),e("#booking-end-time").removeAttr("required").val("23:59")):(e("#booking-time-row").show(),e("#booking-start-time").attr("required","required").val(""),e("#booking-end-time").attr("required","required").val(""))}),e("#booking-type").on("change",function(){"audience"===e(this).val()?(e("#audience-select-group").show(),e("#user-select-group").hide()):(e("#audience-select-group").hide(),e("#user-select-group").show())}),a=[],e("#booking-audiences").on("change",function(){var n=e(this),t=(n.val()||[]).map(function(e){return parseInt(e)}),o=i.config.audiences||[],c=t.slice();o.forEach(function(e){if(e.children&&0!==e.children.length){var n=parseInt(e.id),i=e.children.map(function(e){return parseInt(e.id)}),o=-1!==t.indexOf(n),s=-1!==a.indexOf(n);o&&!s?i.forEach(function(e){-1===c.indexOf(e)&&c.push(e)}):!o&&s&&(c=c.filter(function(e){return-1===i.indexOf(e)}))}}),c.length===t.length&&c.every(function(e){return-1!==t.indexOf(e)})||n.val(c.map(String)),a=(n.val()||[]).map(function(e){return parseInt(e)})}),e("#booking-description").on("input",function(){e("#desc-char-count").text(e(this).val().length)}),e("#booking-user-search").on("input",function(){clearTimeout(t);var n=e(this).val();n.length<2?e("#booking-user-results").removeClass("active").empty():t=setTimeout(function(){!function(n){e.ajax({url:ffcAudience.ajaxUrl,method:"GET",data:{action:"ffc_search_users",query:n,nonce:ffcAudience.nonce},success:function(n){if(n.success&&n.data.length>0){var t="";n.data.forEach(function(e){i.selectedUsers[e.id]||(t+='<div class="ffc-user-result" data-id="'+e.id+'" data-name="'+k(e.name)+'">'+k(e.name)+" ("+k(e.email)+")</div>")}),e("#booking-user-results").html(t).addClass("active")}else e("#booking-user-results").removeClass("active").empty()}})}(n)},300)}),e(document).on("click","#booking-user-results .ffc-user-result",function(){var n=e(this).data("id"),t=e(this).data("name");i.selectedUsers[n]=t,l(),e("#booking-user-results").removeClass("active").empty(),e("#booking-user-search").val("")}),e(document).on("click","#booking-selected-users .remove",function(){var n=e(this).data("id");delete i.selectedUsers[n],l()}),e("#ffc-check-conflicts-btn").on("click",function(){!function(){if(u()){var n=g(),t=e("#ffc-check-conflicts-btn"),i=t.text();t.prop("disabled",!0).text(ffcAudience.strings.loading),e.ajax({url:ffcAudience.restUrl+"conflicts",method:"POST",contentType:"application/json",timeout:3e4,data:JSON.stringify({environment_id:n.environment_id,booking_date:n.booking_date,start_time:n.start_time,end_time:n.end_time,audience_ids:n.audience_ids,user_ids:n.user_ids}),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcAudience.nonce)},success:function(n){try{if(n.success){var i=n.conflicts||{},o="environment"===i.type||"audience_same_day"===i.type;if(e("#ffc-conflict-warning").hide(),e("#ffc-conflict-error").hide(),e("#ffc-conflict-acknowledge").prop("checked",!1),o){var c="";if("environment"===i.type)c="<p><strong>"+(ffcAudience.strings.hardConflict||"This time slot is already booked for this environment.")+"</strong></p><p>"+i.bookings.map(function(e){return e.start_time+"–"+e.end_time}).join(", ")+"</p>";else if("audience_same_day"===i.type){var a={};i.audience_same_day.forEach(function(e){a[e.audience_name]||(a[e.audience_name]=[]),a[e.audience_name].push(e.start_time+"–"+e.end_time)});var s=[];for(var r in a)s.push("<strong>"+r+"</strong>: "+a[r].join(", "));c="<p><strong>"+(ffcAudience.strings.audienceSameDayHard||"This audience group already has a booking on this day.")+"</strong></p><p>"+s.join("<br>")+"</p>"}e("#ffc-conflict-error-details").html(c),e("#ffc-conflict-error").show(),t.hide(),e("#ffc-create-booking-btn").hide()}else{var f=[];if(i.bookings&&i.bookings.length>0&&"user"===i.type){var d=i.affected_users?i.affected_users.length:0;f.push(d+" "+(ffcAudience.strings.membersOverlapping||"member(s) have overlapping bookings."))}t.hide(),f.length>0?(e("#ffc-conflict-details").html(f.join("<br><br>")),e("#ffc-conflict-warning").show(),e("#ffc-create-booking-btn").show().prop("disabled",!0)):e("#ffc-create-booking-btn").show().prop("disabled",!1)}}else alert(n.message||ffcAudience.strings.error)}catch(e){console.error("Error processing conflict response:",e),alert(ffcAudience.strings.error)}},error:function(e,n,t){console.error("Conflict check error:",n,t,e.responseText);var i=ffcAudience.strings.error;e.responseJSON&&e.responseJSON.message?i=e.responseJSON.message:"timeout"===n&&(i=ffcAudience.strings.timeout),alert(i)},complete:function(){t.prop("disabled",!1).text(i)}})}}()}),e("#ffc-create-booking-btn").on("click",function(){!function(){if(u()){var n=g();e("#ffc-create-booking-btn").prop("disabled",!0).text(ffcAudience.strings.loading),e.ajax({url:ffcAudience.restUrl+"bookings",method:"POST",contentType:"application/json",data:JSON.stringify(n),beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",ffcAudience.nonce)},success:function(n){n.success?(alert(ffcAudience.strings.bookingCreated),h(),c()):(e("#ffc-create-booking-btn").prop("disabled",!1).text(ffcAudience.strings.createBooking),alert(n.message||ffcAudience.strings.error))},error:function(){e("#ffc-create-booking-btn").prop("disabled",!1).text(ffcAudience.strings.createBooking),alert(ffcAudience.strings.error)}})}}()}),e("#ffc-conflict-acknowledge").on("change",function(){e("#ffc-create-booking-btn").prop("disabled",!e(this).is(":checked"))}),e("#ffc-new-booking-btn").on("click",function(){var n=e("#ffc-day-modal").data("date");h(),function(n,t){var o=e("#ffc-booking-modal"),c=v(n),a=c.toLocaleDateString(ffcAudience.locale,{weekday:"long",year:"numeric",month:"long",day:"numeric"});e("#ffc-booking-form")[0].reset(),e("#booking-all-day").prop("checked",!1),e("#booking-time-row").show(),e("#booking-start-time").attr("required","required"),e("#booking-end-time").attr("required","required"),i.selectedUsers={},l(),e("#ffc-conflict-warning").hide(),e("#ffc-conflict-error").hide(),e("#ffc-conflict-acknowledge").prop("checked",!1),e("#ffc-check-conflicts-btn").show(),e("#ffc-create-booking-btn").hide().prop("disabled",!1),e("#desc-char-count").text("0"),e("#booking-date").val(n),e(".ffc-booking-date-display").text(a);var s=e("#booking-environment-id");s.empty();for(var r=i.config.schedules||[],f=[],d=0;d<r.length;d++)for(var u=r[d].environments||[],g=0;g<u.length;g++)f.push({id:u[g].id,name:u[g].name,scheduleName:r[d].name});if(f.length>1){var h=r.length>1;f.forEach(function(e){var n=h?e.scheduleName+" - "+e.name:e.name;s.append('<option value="'+e.id+'">'+n+"</option>")})}else 1===f.length&&s.append('<option value="'+f[0].id+'">'+f[0].name+"</option>");var p=null;if(i.selectedSchedule>0){for(var m=0;m<r.length;m++)if(parseInt(r[m].id)===parseInt(i.selectedSchedule)){p=r[m];break}}else 1===r.length&&(p=r[0]);p&&p.environmentLabel&&e('label[for="booking-environment-id"]').html(k(p.environmentLabel)+" *");var b=t||i.selectedEnvironment||"";s.val(b),e("#booking-type").val("audience").trigger("change"),o.show()}(n)}),e("#ffc-booking-modal .ffc-modal-content, #ffc-day-modal .ffc-modal-content").on("click",function(e){e.stopPropagation()}))})}(jQuery);