!function(t){"use strict";var e=25,a='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="12" rx="2" fill="#fff" stroke="#4285F4" stroke-width="1.5"/><path d="M1 5h14" stroke="#4285F4" stroke-width="1.5"/><circle cx="5" cy="9" r="1.2" fill="#EA4335"/><circle cx="8" cy="9" r="1.2" fill="#FBBC04"/><circle cx="11" cy="9" r="1.2" fill="#34A853"/><path d="M5 1v3M11 1v3" stroke="#4285F4" stroke-width="1.5" stroke-linecap="round"/></svg>',n='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="12" rx="2" fill="#fff" stroke="#0078D4" stroke-width="1.5"/><path d="M1 5h14" stroke="#0078D4" stroke-width="1.5"/><rect x="4" y="7" width="3" height="2.5" rx="0.5" fill="#0078D4"/><rect x="9" y="7" width="3" height="2.5" rx="0.5" fill="#0078D4" opacity="0.5"/><path d="M5 1v3M11 1v3" stroke="#0078D4" stroke-width="1.5" stroke-linecap="round"/></svg>',s='<svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 10V3M8 10l-2.5-2.5M8 10l2.5-2.5" stroke="#666" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/><path d="M3 12h10" stroke="#666" stroke-width="1.5" stroke-linecap="round"/></svg>',i='<svg width="14" height="14" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="12" rx="2" fill="none" stroke="#fff" stroke-width="1.5"/><path d="M1 7h14" stroke="#fff" stroke-width="1.2"/><path d="M5 1v3M11 1v3" stroke="#fff" stroke-width="1.5" stroke-linecap="round"/></svg>';function r(t){return t<10?"0"+t:""+t}function o(t){if(!t)return{h:0,m:0};var e=t.split(":");return{h:parseInt(e[0],10)||0,m:parseInt(e[1],10)||0}}function c(t,e){var a=t.replace(/-/g,""),n=o(e);return a+"T"+r(n.h)+r(n.m)+"00"}function d(t,e){return c(t,e)}function f(t,e){var a=o(e);return t+"T"+r(a.h)+":"+r(a.m)+":00"}function l(t){return t?t.replace(/\\/g,"\\\\").replace(/\r/g,"").replace(/\n/g,"\\n").replace(/,/g,"\\,").replace(/;/g,"\\;"):""}function h(t){var e=function(t){var e=window.location.hostname,a=(t.uid||"ffc-"+Date.now())+"@"+e,n=(new Date).toISOString().replace(/[-:]/g,"").replace(/\.\d{3}/,""),s="BEGIN:VCALENDAR\r\n";return s+="VERSION:2.0\r\n",s+="PRODID:-//"+(ffcDashboard.siteName||e)+"//FFC//PT\r\n",s+="CALSCALE:GREGORIAN\r\n",s+="METHOD:PUBLISH\r\n",s+="BEGIN:VEVENT\r\n",s+="UID:"+a+"\r\n",s+="DTSTAMP:"+n+"\r\n",s+="DTSTART:"+c(t.date,t.startTime)+"\r\n",s+="DTEND:"+c(t.date,t.endTime)+"\r\n",s+="SUMMARY:"+l(t.summary)+"\r\n",t.description&&(s+="DESCRIPTION:"+l(t.description)+"\r\n"),t.location&&(s+="LOCATION:"+l(t.location)+"\r\n"),s+="STATUS:CONFIRMED\r\n",s+="END:VEVENT\r\n",s+"END:VCALENDAR\r\n"}(t),a=new Blob([e],{type:"text/calendar;charset=utf-8"}),n=URL.createObjectURL(a),s=document.createElement("a");s.href=n,s.download=(t.summary||"event").replace(/[^a-zA-Z0-9\u00C0-\u024F]/g,"_").substring(0,50)+".ics",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n)}function p(t){var e=function(t){var e=d(t.date,t.startTime)+"/"+d(t.date,t.endTime),a={action:"TEMPLATE",text:t.summary,dates:e,details:t.description||""};t.location&&(a.location=t.location),ffcDashboard.wpTimezone&&(a.ctz=ffcDashboard.wpTimezone);var n=[];for(var s in a)a.hasOwnProperty(s)&&n.push(encodeURIComponent(s)+"="+encodeURIComponent(a[s]));return"https://calendar.google.com/calendar/render?"+n.join("&")}(t),r=function(t){var e={rru:"addevent",subject:t.summary,startdt:f(t.date,t.startTime),enddt:f(t.date,t.endTime),body:t.description||"",path:"/calendar/action/compose"};t.location&&(e.location=t.location);var a=[];for(var n in e)e.hasOwnProperty(n)&&a.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return"https://outlook.live.com/calendar/0/deeplink/compose?"+a.join("&")}(t),o=JSON.stringify(t).replace(/'/g,"&#39;").replace(/"/g,"&quot;"),c='<div class="ffc-cal-export-wrap">';return c+='<button type="button" class="ffc-cal-export-btn">',c+=i+" ",c+=ffcDashboard.strings.exportToCalendar||"Exportar para CalendÃ¡rio",c+=" &#9662;</button>",c+='<div class="ffc-cal-export-dropdown">',c+='<a href="'+e+'" target="_blank" rel="noopener noreferrer">'+a+" Google Calendar</a>",c+='<a href="'+r+'" target="_blank" rel="noopener noreferrer">'+n+" Outlook</a>",c+='<a href="#" class="ffc-cal-export-ics" data-event="'+o+'">'+s+" "+(ffcDashboard.strings.otherIcs||"Outros (.ics)")+"</a>",c+="</div></div>"}var u={init:function(){this.bindEvents(),this.loadInitialTab()},bindEvents:function(){t(document).on("click",".ffc-tab",this.switchTab.bind(this)),t(document).on("keydown",".ffc-tab",this.handleTabKeydown.bind(this)),t(document).on("click",".ffc-pagination-btn",this.handlePagination.bind(this)),t(document).on("click",".ffc-cal-export-btn",function(e){e.preventDefault(),e.stopPropagation();var a=t(this).siblings(".ffc-cal-export-dropdown");t(".ffc-cal-export-dropdown.open").not(a).removeClass("open"),a.toggleClass("open")}),t(document).on("click",".ffc-cal-export-ics",function(e){e.preventDefault();var a=t(this).data("event");a&&h(a),t(this).closest(".ffc-cal-export-dropdown").removeClass("open")}),t(document).on("click",function(){t(".ffc-cal-export-dropdown.open").removeClass("open")}),t(document).on("click",".ffc-cal-export-dropdown",function(t){t.stopPropagation()})},loadInitialTab:function(){var e=t(".ffc-tab.active").data("tab");"certificates"===e?this.loadCertificates():"appointments"===e?this.loadAppointments():"audience"===e?this.loadAudienceBookings():"profile"===e&&this.loadProfile()},switchTab:function(e){e.preventDefault();var a=t(e.currentTarget),n=a.data("tab");if(t(".ffc-tab").removeClass("active").attr("aria-selected","false").attr("tabindex","-1"),a.addClass("active").attr("aria-selected","true").attr("tabindex","0"),t(".ffc-tab-content").removeClass("active"),t("#tab-"+n).addClass("active"),history.pushState){var s=new URL(window.location);s.searchParams.set("tab",n),history.pushState({},"",s)}"certificates"===n?this.loadCertificates():"appointments"===n?this.loadAppointments():"audience"===n?this.loadAudienceBookings():"profile"===n&&this.loadProfile()},handleTabKeydown:function(e){var a=t(".ffc-tab"),n=t(e.currentTarget),s=a.index(n),i=-1;"ArrowRight"===e.key||"ArrowDown"===e.key?(e.preventDefault(),i=(s+1)%a.length):"ArrowLeft"===e.key||"ArrowUp"===e.key?(e.preventDefault(),i=(s-1+a.length)%a.length):"Home"===e.key?(e.preventDefault(),i=0):"End"===e.key&&(e.preventDefault(),i=a.length-1),i>=0&&a.eq(i).focus().trigger("click")},buildPagination:function(t,a,n){if(t<=e)return"";var s=Math.ceil(t/e),i='<div class="ffc-pagination" style="margin-top: 15px; text-align: center;">';return a>1&&(i+='<button class="button ffc-pagination-btn" data-page="'+(a-1)+'" data-target="'+n+'">&laquo; '+(ffcDashboard.strings.previous||"Previous")+"</button> "),i+='<span style="margin: 0 10px; color: #666; font-size: 13px;">',i+=(ffcDashboard.strings.pageOf||"Page {current} of {total}").replace("{current}",a).replace("{total}",s),i+="</span>",a<s&&(i+=' <button class="button ffc-pagination-btn" data-page="'+(a+1)+'" data-target="'+n+'">'+(ffcDashboard.strings.next||"Next")+" &raquo;</button>"),i+="</div>"},handlePagination:function(e){e.preventDefault();var a=t(e.currentTarget),n=parseInt(a.data("page"),10),s=a.data("target");"certificates"===s?this.renderCertificates(this._certificatesData,n):"appointments"===s?this.renderAppointments(this._appointmentsData,n):"audience"===s&&this.renderAudienceBookings(this._audienceData,n)},_certificatesData:null,loadCertificates:function(){var e=t("#tab-certificates");if(0!==e.length)if(void 0===ffcDashboard.canViewCertificates||ffcDashboard.canViewCertificates){if(null===this._certificatesData){e.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/certificates";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),t.ajax({url:a,method:"GET",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(t){u._certificatesData=t.certificates||[],u.renderCertificates(u._certificatesData,1)},error:function(){e.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}}else e.html('<div class="ffc-error">'+ffcDashboard.strings.noPermission+"</div>")},renderCertificates:function(a,n){var s=t("#tab-certificates");if(n=n||1,a&&0!==a.length){var i=(n-1)*e,r=a.slice(i,i+e),o='<table class="ffc-certificates-table">';o+="<thead>",o+="<tr>",o+="<th>"+ffcDashboard.strings.eventName+"</th>",o+="<th>"+ffcDashboard.strings.date+"</th>",o+="<th>"+ffcDashboard.strings.consent+"</th>",o+="<th>"+ffcDashboard.strings.email+"</th>",o+="<th>"+ffcDashboard.strings.code+"</th>",o+="<th>"+ffcDashboard.strings.actions+"</th>",o+="</tr>",o+="</thead>",o+="<tbody>",r.forEach(function(t){o+="<tr>",o+="<td>"+t.form_title+"</td>",o+="<td>"+t.submission_date+"</td>",o+='<td><span class="'+(t.consent_given?"consent-yes":"consent-no")+'">',o+=t.consent_given?ffcDashboard.strings.yes:ffcDashboard.strings.no,o+="</span></td>",o+="<td>"+t.email+"</td>",o+="<td>"+t.auth_code+"</td>",o+="<td>",o+='<a href="'+t.magic_link+'" class="button" target="_blank">',o+="ðŸ“„ "+ffcDashboard.strings.downloadPdf,o+="</a>",o+="</td>",o+="</tr>"}),o+="</tbody>",o+="</table>",o+=this.buildPagination(a.length,n,"certificates"),s.html(o)}else s.html('<div class="ffc-empty-state"><p>ðŸ“œ</p><p>'+ffcDashboard.strings.noCertificates+"</p></div>")},_appointmentsData:null,loadAppointments:function(){var e=t("#tab-appointments");if(0!==e.length)if(void 0===ffcDashboard.canViewAppointments||ffcDashboard.canViewAppointments){if(null===this._appointmentsData){e.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/appointments";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),t.ajax({url:a,method:"GET",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(t){u._appointmentsData=t.appointments||[],u.renderAppointments(u._appointmentsData,1)},error:function(){e.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}}else e.html('<div class="ffc-error">'+ffcDashboard.strings.noPermission+"</div>")},renderAppointments:function(a,n){var s=t("#tab-appointments");if(n=n||1,a&&0!==a.length){var i=(new Date).toISOString().slice(0,10),r=[],o=[],c=[];a.forEach(function(t){"cancelled"===t.status?c.push(t):t.appointment_date_raw<i||"completed"===t.status||"no_show"===t.status?o.push(t):r.push(t)});var d=[];r.forEach(function(t){t._section="upcoming",d.push(t)}),o.forEach(function(t){t._section="past",d.push(t)}),c.forEach(function(t){t._section="cancelled",d.push(t)});var f=(n-1)*e,l=d.slice(f,f+e),h="",m="";l.forEach(function(t){var e=t._section;if(e!==m){""!==m&&(h+="</tbody></table>"),m=e;var a="",n=!1;"upcoming"===e?a=ffcDashboard.strings.upcoming||"Upcoming":"past"===e?(a=ffcDashboard.strings.past||"Past",n=!0):(a=ffcDashboard.strings.cancelled||"Cancelled",n=!0),h+="<h3"+("upcoming"!==e?' style="margin-top: 30px;"':"")+">"+a+"</h3>",h+='<table class="ffc-appointments-table'+(n?" past-appointments":"")+'">',h+="<thead><tr>",h+="<th>"+ffcDashboard.strings.calendar+"</th>",h+="<th>"+ffcDashboard.strings.date+"</th>",h+="<th>"+ffcDashboard.strings.time+"</th>",h+="<th>"+ffcDashboard.strings.status+"</th>",h+="<th>"+ffcDashboard.strings.actions+"</th>",h+="</tr></thead><tbody>"}var s="";if("cancelled"===t.status?s="cancelled-row":"past"===e&&(s="past-row"),h+="<tr"+(s?' class="'+s+'"':"")+">",h+="<td>"+t.calendar_title+"</td>",h+="<td>"+t.appointment_date+"</td>",h+="<td>"+t.start_time+"</td>",h+='<td><span class="appointment-status status-'+t.status+'">'+t.status_label+"</span></td>",h+="<td>",t.receipt_url&&(h+='<a href="'+t.receipt_url+'" class="button" target="_blank" style="margin-right: 5px;">',h+="ðŸ“„ "+(ffcDashboard.strings.viewReceipt||"View Receipt"),h+="</a>"),t.can_cancel&&(h+='<button class="button ffc-cancel-appointment" data-id="'+t.id+'">',h+=ffcDashboard.strings.cancelAppointment,h+="</button>"),"upcoming"===e&&"confirmed"===t.status){var i={uid:"ffc-apt-"+t.id,summary:t.calendar_title,description:t.calendar_title+(t.name?"\n"+(ffcDashboard.strings.name||"Nome:")+" "+t.name:"")+(t.email?"\n"+(ffcDashboard.strings.email||"Email:")+" "+t.email:""),location:ffcDashboard.mainAddress||"",date:t.appointment_date_raw,startTime:t.start_time_raw,endTime:t.end_time||t.start_time_raw};h+=" "+p(i)}h+="</td>",h+="</tr>"}),""!==m&&(h+="</tbody></table>"),h+=this.buildPagination(d.length,n,"appointments"),s.html(h),s.on("click",".ffc-cancel-appointment",function(e){e.preventDefault();var a=t(this).data("id");u.cancelAppointment(a)})}else s.html('<div class="ffc-empty-state"><p>ðŸ“…</p><p>'+ffcDashboard.strings.noAppointments+"</p></div>")},_audienceData:null,loadAudienceBookings:function(){var e=t("#tab-audience");if(0!==e.length)if(void 0===ffcDashboard.canViewAudienceBookings||ffcDashboard.canViewAudienceBookings){if(null===this._audienceData){e.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/audience-bookings";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),t.ajax({url:a,method:"GET",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(t){u._audienceData=t.bookings||[],u.renderAudienceBookings(u._audienceData,1)},error:function(){e.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}}else e.html('<div class="ffc-error">'+ffcDashboard.strings.noPermission+"</div>")},renderAudienceBookings:function(a,n){var s=t("#tab-audience");if(n=n||1,a&&0!==a.length){var i=a.filter(function(t){return!t.is_past&&"cancelled"!==t.status}),r=a.filter(function(t){return t.is_past&&"cancelled"!==t.status}),o=a.filter(function(t){return"cancelled"===t.status}),c=[].concat(i,r,o),d=(n-1)*e,f=c.slice(d,d+e),l="",h="";f.forEach(function(t){var e;if((e="cancelled"===t.status?"cancelled":t.is_past?"past":"upcoming")!==h){var a;""!==h&&(l+="</tbody></table>"),h=e;var n=!1;"upcoming"===e?a=ffcDashboard.strings.upcoming||"Upcoming":"past"===e?(a=ffcDashboard.strings.past||"Past",n=!0):(a=ffcDashboard.strings.cancelled||"Cancelled",n=!0),l+="<h3"+("upcoming"!==h?' style="margin-top: 30px;"':"")+">"+a+"</h3>",l+='<table class="ffc-audience-bookings-table'+(n?" past-bookings":"")+'">',l+="<thead><tr>",l+="<th>"+(ffcDashboard.strings.environment||"Environment")+"</th>",l+="<th>"+(ffcDashboard.strings.date||"Date")+"</th>",l+="<th>"+(ffcDashboard.strings.time||"Time")+"</th>",l+="<th>"+(ffcDashboard.strings.description||"Description")+"</th>",l+="<th>"+(ffcDashboard.strings.audiences||"Audiences")+"</th>",l+="<th>"+(ffcDashboard.strings.actions||"Actions")+"</th>",l+="</tr></thead><tbody>"}var s="";if("cancelled"===t.status?s="cancelled-row":t.is_past&&(s="past-row"),l+="<tr"+(s?' class="'+s+'"':"")+">",l+="<td>"+t.environment_name,t.schedule_name&&(l+='<br><small style="color: #666;">'+t.schedule_name+"</small>"),l+="</td>",l+="<td>"+t.booking_date+"</td>",l+="<td>"+t.start_time+" - "+t.end_time+"</td>",l+="<td>"+(t.description||"")+"</td>",l+="<td>",t.audiences&&t.audiences.length>0&&t.audiences.forEach(function(t){l+='<span class="ffc-audience-tag" style="background-color: '+t.color+'; color: #fff; padding: 2px 8px; border-radius: 3px; font-size: 12px;">',l+=t.name,l+="</span>"}),l+="</td>",l+="<td>","upcoming"===e&&"cancelled"!==t.status){var i="";t.audiences&&t.audiences.length>0&&(i=t.audiences.map(function(t){return t.name}).join(", "));var r={uid:"ffc-booking-"+t.id,summary:t.description||t.environment_name,description:(t.environment_name?(ffcDashboard.strings.environment||"Ambiente")+": "+t.environment_name:"")+(t.schedule_name?"\n"+t.schedule_name:"")+(t.description?"\n"+t.description:"")+(i?"\n"+(ffcDashboard.strings.audiences||"AudiÃªncias")+": "+i:""),location:t.environment_name||"",date:t.booking_date_raw,startTime:t.start_time,endTime:t.end_time||t.start_time};l+=p(r)}l+="</td>",l+="</tr>"}),""!==h&&(l+="</tbody></table>"),l+=this.buildPagination(c.length,n,"audience"),s.html(l)}else s.html('<div class="ffc-empty-state"><p>ðŸ‘¥</p><p>'+ffcDashboard.strings.noAudienceBookings+"</p></div>")},cancelAppointment:function(e){confirm(ffcDashboard.strings.confirmCancel)&&t.ajax({url:ffcDashboard.ajaxUrl,method:"POST",data:{action:"ffc_cancel_appointment",appointment_id:e,nonce:ffcDashboard.nonce},success:function(e){e.success?(alert(ffcDashboard.strings.cancelSuccess),u._appointmentsData=null,t("#tab-appointments").html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>"),u.loadAppointments()):alert(e.data.message||ffcDashboard.strings.cancelError)},error:function(){alert(ffcDashboard.strings.cancelError)}})},loadProfile:function(){var e=t("#tab-profile");if(!(e.find(".ffc-profile-info").length>0)){e.html('<div class="ffc-loading">'+ffcDashboard.strings.loading+"</div>");var a=ffcDashboard.restUrl+"user/profile";ffcDashboard.viewAsUserId&&(a+="?viewAsUserId="+ffcDashboard.viewAsUserId),t.ajax({url:a,method:"GET",beforeSend:function(t){t.setRequestHeader("X-WP-Nonce",ffcDashboard.nonce)},success:function(t){u.renderProfile(t)},error:function(){e.html('<div class="ffc-error">'+ffcDashboard.strings.error+"</div>")}})}},renderProfile:function(e){var a=t("#tab-profile"),n='<div class="ffc-profile-info">';n+='<div class="ffc-profile-field">',n+="<label>"+ffcDashboard.strings.name+"</label>",e.names&&e.names.length>1?(n+='<ul class="name-list">',e.names.forEach(function(t){n+="<li>"+t+"</li>"}),n+="</ul>"):e.names&&1===e.names.length?n+='<div class="value">'+e.names[0]+"</div>":n+='<div class="value">'+(e.display_name||"-")+"</div>",n+="</div>",n+='<div class="ffc-profile-field">',n+="<label>"+ffcDashboard.strings.linkedEmails+"</label>",e.emails&&e.emails.length>1?(n+='<ul class="email-list">',e.emails.forEach(function(t){n+="<li>"+t+"</li>"}),n+="</ul>"):e.emails&&1===e.emails.length?n+='<div class="value">'+e.emails[0]+"</div>":n+='<div class="value">'+(e.email||"-")+"</div>",n+="</div>",n+='<div class="ffc-profile-field">',n+="<label>"+ffcDashboard.strings.cpfRf+"</label>",e.cpfs_masked&&e.cpfs_masked.length>1?(n+='<ul class="cpf-list">',e.cpfs_masked.forEach(function(t){n+="<li>"+t+"</li>"}),n+="</ul>"):e.cpfs_masked&&1===e.cpfs_masked.length?n+='<div class="value">'+e.cpfs_masked[0]+"</div>":n+='<div class="value">'+(e.cpf_masked||"-")+"</div>",n+="</div>",e.audience_groups&&e.audience_groups.length>0&&(n+='<div class="ffc-profile-field">',n+="<label>"+(ffcDashboard.strings.audienceGroups||"Groups")+"</label>",n+='<div class="value" style="display: flex; flex-wrap: wrap; gap: 6px;">',e.audience_groups.forEach(function(t){n+='<span style="background-color: '+(t.color||"#2271b1")+'; color: #fff; padding: 4px 12px; border-radius: 3px; font-size: 13px;">',n+=t.name,n+="</span>"}),n+="</div>",n+="</div>"),n+='<div class="ffc-profile-field">',n+="<label>"+ffcDashboard.strings.memberSince+"</label>",n+='<div class="value">'+(e.member_since||"-")+"</div>",n+="</div>",n+="</div>",a.html(n)}};t(document).ready(function(){t("#ffc-user-dashboard").length>0&&u.init()})}(jQuery);