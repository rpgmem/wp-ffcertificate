!function(e){"use strict";const t={init:function(){this.bindEvents()},bindEvents:function(){e(document).on("change",'.ffc-day-row input[type="checkbox"]',function(){e(this).closest(".ffc-day-row").find('input[type="time"]').prop("disabled",e(this).is(":checked"))}),this.initUserSearch(),this.initEnvironmentFilter(),this.initBookingActions()},initUserSearch:function(){var t=e("#user_search");if(t.length){var n,i={},a="undefined"!=typeof ffcAudienceAdmin?ffcAudienceAdmin.nonce:"";t.on("input",function(){clearTimeout(n);var t=e(this).val();t.length<2?e("#user_results").removeClass("active").empty():n=setTimeout(function(){e.ajax({url:ajaxurl,data:{action:"ffc_search_users",query:t,nonce:a},success:function(t){if(t.success&&t.data.length>0){var n="";t.data.forEach(function(e){i[e.id]||(n+='<div class="ffc-user-result" data-id="'+e.id+'" data-name="'+e.name+'">'+e.name+" ("+e.email+")</div>")}),e("#user_results").html(n).addClass("active")}else e("#user_results").removeClass("active").empty()}})},300)}),e(document).on("click",".ffc-user-result",function(){var n=e(this).data("id"),a=e(this).data("name");i[n]=a,c(),e("#user_results").removeClass("active").empty(),t.val("")}),e(document).on("click",".ffc-selected-user .remove",function(){var t=e(this).data("id");delete i[t],c()})}function c(){var t="",n=[];for(var a in i)t+='<span class="ffc-selected-user">'+i[a]+'<span class="remove" data-id="'+a+'">&times;</span></span>',n.push(a);e("#selected_users").html(t),e("#selected_user_ids").val(n.join(","))}},initEnvironmentFilter:function(){var t=e("#filter-schedule"),n=e("#filter-environment");if(t.length&&n.length){var i="undefined"!=typeof ffcAudienceAdmin?ffcAudienceAdmin.strings:{},a="undefined"!=typeof ffcAudienceAdmin?ffcAudienceAdmin.adminNonce:"",c=i.allEnvironments||"All Environments",o=i.loading||"Loading...";t.on("change",function(){var t=e(this).val();t?(n.html('<option value="">'+o+"</option>"),e.ajax({url:ajaxurl,type:"GET",data:{action:"ffc_audience_get_environments",schedule_id:t,nonce:a},success:function(t){if(t.success&&t.data){var i='<option value="">'+c+"</option>";e.each(t.data,function(t,n){i+='<option value="'+n.id+'">'+e("<div/>").text(n.name).html()+"</option>"}),n.html(i)}else n.html('<option value="">'+c+"</option>")},error:function(){n.html('<option value="">'+c+"</option>")}})):n.html('<option value="">'+c+"</option>")})}},initBookingActions:function(){if(e(".ffc-view-booking").length||e(".ffc-cancel-booking").length){var t="undefined"!=typeof ffcAudienceAdmin?ffcAudienceAdmin.strings:{},n="undefined"!=typeof ffcAudienceAdmin?ffcAudienceAdmin.adminNonce:"";e(document).on("click",".ffc-view-booking",function(a){a.preventDefault();var c=e(this).data("booking-id");e("#ffc-booking-modal").remove();var o=e('<div id="ffc-booking-modal" class="ffc-admin-modal-overlay"><div class="ffc-admin-modal"><div class="ffc-admin-modal-header"><h3>'+i(t.bookingDetails||"Booking Details")+'</h3><button type="button" class="ffc-admin-modal-close">&times;</button></div><div class="ffc-admin-modal-body"><p>'+i(t.loading||"Loading...")+"</p></div></div></div>");e("body").append(o),o.show(),e.ajax({url:ajaxurl,type:"GET",data:{action:"ffc_audience_get_booking",booking_id:c,nonce:n},success:function(e){if(e.success){var n=e.data,a=parseInt(n.is_all_day)?t.allDay||"All Day":n.start_time+" - "+n.end_time,c="audience"===n.booking_type?t.audience||"Audience":t.customUsers||"Custom Users",s="active"===n.status?t.active||"Active":t.cancelled||"Cancelled",d="active"===n.status?"status-active":"status-cancelled",r='<table class="widefat fixed"><tbody>';if(r+="<tr><th>"+i(t.date||"Date")+"</th><td>"+i(n.booking_date)+"</td></tr>",r+="<tr><th>"+i(t.time||"Time")+"</th><td>"+i(a)+"</td></tr>",r+="<tr><th>"+i(t.environmentLabel||"Environment")+"</th><td>"+i(n.environment_name)+"</td></tr>",r+="<tr><th>"+i(t.description||"Description")+"</th><td>"+i(n.description)+"</td></tr>",r+="<tr><th>"+i(t.type||"Type")+"</th><td>"+i(c)+"</td></tr>",r+="<tr><th>"+i(t.status||"Status")+'</th><td><span class="'+d+'">'+i(s)+"</span></td></tr>",r+="<tr><th>"+i(t.createdBy||"Created By")+"</th><td>"+i(n.created_by)+"</td></tr>",n.audiences&&n.audiences.length>0){var l=n.audiences.map(function(e){return e.name}).join(", ");r+="<tr><th>"+i(t.audiences||"Audiences")+"</th><td>"+i(l)+"</td></tr>"}if(n.users&&n.users.length>0){var u=n.users.map(function(e){return e.name+" ("+e.email+")"}).join(", ");r+="<tr><th>"+i(t.users||"Users")+"</th><td>"+i(u)+"</td></tr>"}"cancelled"===n.status&&n.cancel_reason&&(r+="<tr><th>"+i(t.cancelReason||"Cancel Reason")+"</th><td>"+i(n.cancel_reason)+"</td></tr>"),r+="</tbody></table>",o.find(".ffc-admin-modal-body").html(r)}else o.find(".ffc-admin-modal-body").html("<p>"+i(e.data.message||t.error)+"</p>")},error:function(){o.find(".ffc-admin-modal-body").html("<p>"+i(t.error||"An error occurred.")+"</p>")}})}),e(document).on("click",".ffc-admin-modal-close, .ffc-admin-modal-overlay",function(t){t.target===this&&e("#ffc-booking-modal").remove()}),e(document).on("click",".ffc-cancel-booking",function(i){i.preventDefault();var a=e(this),c=a.data("booking-id");if(confirm(t.confirmCancel||"Are you sure you want to cancel this booking?")){var o=prompt(t.cancelReason||"Please provide a reason for cancellation:");null!==o&&(a.css("pointer-events","none").css("opacity","0.5"),e.ajax({url:ajaxurl,type:"POST",data:{action:"ffc_audience_cancel_booking",booking_id:c,reason:o,nonce:n},success:function(e){e.success?(a.closest("tr").find(".status-active").removeClass("status-active").addClass("status-cancelled").text(t.cancelled||"Cancelled"),a.prev().remove(),a.remove()):(alert(e.data.message||t.error),a.css("pointer-events","").css("opacity",""))},error:function(){alert(t.error||"An error occurred."),a.css("pointer-events","").css("opacity","")}}))}})}function i(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e||"")),t.innerHTML}}};e(document).ready(function(){t.init()})}(jQuery);