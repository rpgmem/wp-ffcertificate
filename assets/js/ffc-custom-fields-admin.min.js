!function(e){"use strict";var f=0;function i(){f++;var i=wp.template("ffc-custom-field-row")({index:f});e("#ffc-custom-fields-list").append(i),e("#ffc-custom-fields-list .ffc-custom-field-row:last").find(".ffc-field-details-row").show(),e("#ffc-custom-fields-list").sortable("refresh")}function c(){var f=e("#ffc-save-custom-fields"),i=e("#ffc-custom-fields-status"),c=e("#ffc-custom-fields-container").data("audience-id");if(c){var t=[];e("#ffc-custom-fields-list .ffc-custom-field-row").each(function(){var f=e(this),i=f.data("field-id"),c=(f.find(".ffc-field-choices").val()||"").split("\n").filter(function(e){return""!==e.trim()});t.push({id:i,label:f.find(".ffc-field-label").val(),key:f.find(".ffc-field-key").val(),type:f.find(".ffc-field-type").val(),is_required:f.find(".ffc-field-required").is(":checked")?1:0,is_active:f.find(".ffc-field-active").is(":checked")?1:0,choices:c,help_text:f.find(".ffc-field-help").val(),format:f.find(".ffc-field-format").val(),custom_regex:f.find(".ffc-field-regex").val(),custom_regex_message:f.find(".ffc-field-regex-msg").val()})}),f.prop("disabled",!0),i.text(ffcAudienceAdmin.strings.saving||"Saving...").removeClass("ffc-status-error ffc-status-success"),e.post(ffcAudienceAdmin.ajaxUrl,{action:"ffc_save_custom_fields",nonce:ffcAudienceAdmin.adminNonce,audience_id:c,fields:JSON.stringify(t)}).done(function(e){e.success?(i.text(ffcAudienceAdmin.strings.saved||"Saved!").addClass("ffc-status-success"),setTimeout(function(){window.location.reload()},800)):i.text(e.data.message||"Error").addClass("ffc-status-error")}).fail(function(){i.text(ffcAudienceAdmin.strings.error||"Error").addClass("ffc-status-error")}).always(function(){f.prop("disabled",!1)})}}function t(){var f=e(this).closest(".ffc-custom-field-row"),i=f.data("field-id"),c=0===String(i).indexOf("new_");confirm(ffcAudienceAdmin.strings.confirmDelete||"Are you sure?")&&(c?f.fadeOut(200,function(){e(this).remove()}):e.post(ffcAudienceAdmin.ajaxUrl,{action:"ffc_delete_custom_field",nonce:ffcAudienceAdmin.adminNonce,field_id:i}).done(function(i){i.success?f.fadeOut(200,function(){e(this).remove()}):alert(i.data.message||"Error deleting field.")}).fail(function(){alert(ffcAudienceAdmin.strings.error||"Error")}))}function s(){e(this).closest(".ffc-custom-field-row").find(".ffc-field-details-row").slideToggle(200)}function d(){var f=e(this).closest(".ffc-custom-field-row"),i=e(this).val();f.find(".ffc-field-options-container").toggle("select"===i)}function n(){var f=e(this).closest(".ffc-custom-field-row"),i=e(this).val();f.find(".ffc-field-regex, .ffc-field-regex-msg").toggle("custom_regex"===i)}function o(){e(this).closest(".ffc-custom-field-row").toggleClass("ffc-field-inactive",!e(this).is(":checked"))}e(function(){e("#ffc-custom-fields-list").sortable({handle:".ffc-field-handle",placeholder:"ffc-sortable-placeholder",opacity:.7,cursor:"move",tolerance:"pointer"}),e("#ffc-add-custom-field").on("click",i),e("#ffc-save-custom-fields").on("click",c),e(document).on("click",".ffc-field-delete",t),e(document).on("click",".ffc-field-toggle-details",s),e(document).on("change",".ffc-field-type",d),e(document).on("change",".ffc-field-format",n),e(document).on("change",".ffc-field-active",o)})}(jQuery);