!function(e,a){"use strict";function n(){return"undefined"==typeof html2canvas?(console.error("[FFC PDF] html2canvas library not loaded"),!1):void 0!==a.jspdf&&void 0!==a.jspdf.jsPDF||(console.error("[FFC PDF] jsPDF library not loaded"),!1)}function o(){e("#ffc-pdf-overlay").fadeOut(300,function(){e(this).remove()})}function t(t,i){if(console.log("[FFC PDF] Starting PDF generation..."),console.log("[FFC PDF] Template length:",t.template?t.template.length:0),!n()){var r="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pdfLibrariesFailed?ffc_ajax.strings.pdfLibrariesFailed:"PDF libraries failed to load. Please refresh the page.";return void alert(r)}const{jsPDF:s}=a.jspdf;!function(){if(!(e("#ffc-pdf-overlay").length>0)){var a=e('<div id="ffc-pdf-overlay"></div>').css({position:"fixed",top:"0",left:"0",width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.8)","z-index":"999999",display:"flex","align-items":"center","justify-content":"center"}),n=e("<div></div>").css({background:"white",padding:"40px","border-radius":"8px","text-align":"center","max-width":"400px","box-shadow":"0 4px 20px rgba(0,0,0,0.3)"}),o=e('<div class="ffc-spinner"></div>').css({border:"4px solid #f3f3f3","border-top":"4px solid #2271b1","border-radius":"50%",width:"50px",height:"50px",margin:"0 auto 20px",animation:"ffc-spin 1s linear infinite"}),t="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.generatingPdf?ffc_ajax.strings.generatingPdf:"Generating PDF...",i=e("<h3></h3>").css({margin:"0 0 10px 0",color:"#333","font-size":"18px","font-weight":"600"}).text(t),r="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pleaseWait?ffc_ajax.strings.pleaseWait:"Please wait, this may take a few seconds...",s=e("<p></p>").css({margin:"0",color:"#666","font-size":"14px","line-height":"1.5"}).text(r);n.append(o).append(i).append(s),a.append(n),e("body").append(a),e("#ffc-spinner-animation").length||e('<style id="ffc-spinner-animation">@keyframes ffc-spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }</style>').appendTo("head")}}();var f=Date.now(),d=e('<div class="ffc-pdf-temp-container"></div>').css({position:"fixed",top:"0",left:"0",width:"1123px",height:"794px",overflow:"hidden",background:"white","z-index":"999998",opacity:"0"}).appendTo("body"),l=t.template||"";console.log("[FFC PDF] HTML preview:",l.substring(0,200));var c='<div class="ffc-pdf-wrapper" style="width:100%;height:100%;position:relative;">';t.bg_image&&(c+='<img src="'+t.bg_image+'" class="ffc-pdf-bg" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;" crossorigin="anonymous">'),c+='<div class="ffc-pdf-content" style="position:relative;z-index:1;">'+l+"</div>",c+="</div>",d.html(c),console.log("[FFC PDF] Container created and visible");var g,F=d.find("img"),p=F.length,h=0;function m(){h++,console.log("[FFC PDF] Image loaded: "+h+"/"+p),h>=p&&(clearTimeout(g),console.log("[FFC PDF] All images loaded! Generating PDF..."),x())}function x(){var a=Date.now()-f,n=Math.max(0,800-a);console.log("[FFC PDF] Elapsed:",a+"ms","Remaining:",n+"ms"),setTimeout(function(){var a=d.find(".ffc-pdf-wrapper")[0];if(!a){console.error("[FFC PDF] Wrapper not found!");var n="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.pdfContainerNotFound?ffc_ajax.strings.pdfContainerNotFound:"Error: PDF container not found";return alert(n),d.remove(),void o()}var t=1123,r=794;console.log("[FFC PDF] === PDF Generation Started ==="),console.log("[FFC PDF] Target:","1123x794px"),e(a).css({width:t+"px",height:r+"px","max-width":t+"px","max-height":r+"px",transform:"scale(1)",overflow:"hidden","box-sizing":"border-box"}),setTimeout(function(){console.log("[FFC PDF] Capturing with html2canvas..."),html2canvas(a,{scale:2,width:t,height:r,useCORS:!0,allowTaint:!1,logging:!0,backgroundColor:"#ffffff"}).then(function(e){try{console.log("[FFC PDF] Canvas:",e.width+"x"+e.height+"px");for(var a=e.getContext("2d").getImageData(0,0,e.width,e.height),n=!1,t=0;t<a.data.length;t+=4){var r=a.data[t],f=a.data[t+1],l=a.data[t+2];if(255!==r||255!==f||255!==l){n=!0;break}}console.log("[FFC PDF] Canvas has content?",n),n||console.warn("[FFC PDF] Canvas is blank! Check HTML/CSS.");var c=new s("landscape","mm","a4"),g=e.toDataURL("image/png",1);c.addImage(g,"PNG",0,0,297,210),c.save(i||"certificate.pdf"),console.log("[FFC PDF] PDF saved:",i),console.log("[FFC PDF] === Complete ==="),d.remove(),o()}catch(e){console.error("[FFC PDF] Error:",e);var F="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.errorGeneratingPdf?ffc_ajax.strings.errorGeneratingPdf:"Error generating PDF";alert(F),d.remove(),o()}}).catch(function(e){console.error("[FFC PDF] html2canvas error:",e);var a="undefined"!=typeof ffc_ajax&&ffc_ajax.strings&&ffc_ajax.strings.html2canvasFailed?ffc_ajax.strings.html2canvasFailed:"Error: html2canvas failed";alert(a),d.remove(),o()})},300)},n)}console.log("[FFC PDF] Waiting for "+p+" images to load..."),p>0?(g=setTimeout(function(){console.log("[FFC PDF] Timeout. Generating with "+h+"/"+p+" images."),x()},1e4),F.each(function(a){var n=this,o=e(n),t=o.attr("src");if(console.log("[FFC PDF] Image "+(a+1)+":",t?t.substring(0,80):"no src"),n.complete&&n.naturalHeight>0)console.log("[FFC PDF] Image "+(a+1)+" already loaded"),m();else if(o.one("load",function(){console.log("[FFC PDF] Image "+(a+1)+" loaded"),m()}),o.one("error",function(){console.warn("[FFC PDF] Image "+(a+1)+" failed:",t),m()}),t&&!t.startsWith("data:")){var i=n.src;n.src="",n.src=i}})):(console.log("[FFC PDF] No images, generating immediately"),x())}a.ffcGeneratePDF=t,a.ffcPdfGenerator={generatePDF:t,checkLibraries:n},console.log("[FFC PDF] PDF Generator module loaded (FIXED)")}(jQuery,window);