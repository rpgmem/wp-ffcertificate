jQuery(document).ready(function(e){"use strict";e(".ffc-copy-magic-link").on("click",function(s){s.preventDefault();var a=e(this).data("url"),t=e(this),i=e("<input>");e("body").append(i),i.val(a).select(),document.execCommand("copy"),i.remove();var c=t.text();t.text(ffc_submission_edit.copied_text).prop("disabled",!0),setTimeout(function(){t.text(c).prop("disabled",!1)},2e3)}),e(".ffc-unlink-user-btn").on("click",function(s){s.preventDefault();var a=e(this).data("confirm");confirm(a)&&(e('input[name="linked_user_id"]').val(""),e(this).closest("form").submit())});var s=e("#ffc-user-search-input"),a=e(".ffc-search-user-btn"),t=e("#ffc-search-spinner"),i=e("#ffc-user-search-results"),c=e("#ffc-selected-user-preview"),n=e("#ffc-selected-user-id");function r(){var n=s.val().trim();n.length<2?alert(ffc_submission_edit.search_min_chars||"Please enter at least 2 characters."):(t.addClass("is-active"),i.hide(),c.hide(),e.ajax({url:ajaxurl,type:"POST",data:{action:"ffc_search_user",nonce:a.data("nonce"),search:n},success:function(e){var s,a,c;t.removeClass("is-active"),e.success&&e.data.users?(a=e.data.users,c="",a.forEach(function(e){c+='<div class="ffc-search-result-item" data-user-id="'+e.id+'" data-display-name="'+f(e.display_name)+'" data-email="'+f(e.email)+'" data-avatar="'+f(e.avatar)+'">',c+='<img src="'+f(e.avatar)+'" alt="" width="32" height="32">',c+='<div class="ffc-search-result-info">',c+='<span class="ffc-search-result-name">'+f(e.display_name)+"</span>",c+='<span class="ffc-search-result-email">'+f(e.email)+"</span>",c+='<span class="ffc-search-result-id">ID: '+e.id+"</span>",c+="</div>",c+="</div>"}),i.html(c).show()):(s=e.data.message||ffc_submission_edit.no_users_found||"No users found.",i.html('<div class="ffc-no-results">'+f(s)+"</div>").show())},error:function(){t.removeClass("is-active"),alert(ffc_submission_edit.search_error||"Error searching for users. Please try again.")}}))}function f(e){if(!e)return"";var s=document.createElement("div");return s.appendChild(document.createTextNode(e)),s.innerHTML}a.on("click",function(){r()}),s.on("keypress",function(e){13===e.which&&(e.preventDefault(),r())}),e(document).on("click",".ffc-search-result-item",function(){var a=e(this).data("user-id"),t=e(this).data("display-name"),r=e(this).data("email"),l=e(this).data("avatar");n.val(a);var d='<img src="'+f(l)+'" alt="" width="32" height="32">';d+='<div class="ffc-selected-info">',d+="<strong>"+f(t)+"</strong> ",d+='<span class="ffc-user-email">('+f(r)+")</span> ",d+='<span class="ffc-user-id">ID: '+a+"</span>",d+="</div>",d+='<span class="ffc-clear-selection">'+(ffc_submission_edit.clear_selection||"Clear")+"</span>",c.html(d).show(),i.hide(),s.val("")}),e(document).on("click",".ffc-clear-selection",function(){n.val(""),c.hide()}),e(".ffc-consent-header").on("click keypress",function(s){if("keypress"!==s.type||13===s.which||32===s.which){s.preventDefault();var a=e(this).closest(".ffc-consent-box"),t=a.find(".ffc-consent-details");a.hasClass("is-open")?(t.slideUp(200),a.removeClass("is-open"),e(this).attr("aria-expanded","false")):(t.slideDown(200),a.addClass("is-open"),e(this).attr("aria-expanded","true"))}})});